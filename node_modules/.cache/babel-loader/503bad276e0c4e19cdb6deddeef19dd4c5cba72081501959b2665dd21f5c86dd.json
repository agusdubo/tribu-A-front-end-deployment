{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{Loader}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:8080';// ID de Roles\n// ID '1f14...': Aparece en Martin, Lucia, Mariana -> Asumimos DEVELOPER\nconst ROL_ID_DEVELOPER=\"1f14a491-e26d-4092-86ea-d76f20c165d1\";// ID '6e6e...': Aparece solo en Horacio -> Asumimos MANAGER\nconst ROL_ID_MANAGER=\"6e6ecd47-fa18-490e-b25a-c9101a398b6d\";const LoginPage=()=>{const navigate=useNavigate();const[employees,setEmployees]=useState([]);const[employeeCode,setEmployeeCode]=useState('');const[loading,setLoading]=useState(false);const[loadingEmployees,setLoadingEmployees]=useState(true);const[error,setError]=useState('');// ========================\n// LOGICA DINAMICA DE ROLES\n// ========================\nconst determineRole=rolId=>{if(!rolId)return'DEVELOPER';if(rolId===ROL_ID_MANAGER){return'MANAGER';}return'DEVELOPER';};// Helper para mostrar un nombre legible en el select\nconst getRoleLabel=rolId=>{if(rolId===ROL_ID_MANAGER)return'Manager';if(rolId===ROL_ID_DEVELOPER)return'Desarrollador';return'Desconocido';};// Carga inicial de los empleados\nuseEffect(()=>{const loadEmployees=async()=>{try{const response=await fetch(\"\".concat(API_BASE_URL,\"/api/resources\"));if(!response.ok){throw new Error('No se pudo conectar con el sistema de RRHH');}const data=await response.json();console.log('Empleados cargados:',data);setEmployees(data);setLoadingEmployees(false);}catch(error){console.error('Error:',error);setError('Error de conexión con el servidor');setLoadingEmployees(false);}};// Limpiamos sesión vieja al entrar al login\nsessionStorage.clear();loadEmployees();},[]);const handleLogin=e=>{e.preventDefault();if(!employeeCode){setError('Por favor seleccione un usuario');return;}setLoading(true);setError('');try{var _employee$rol;// 1. Encontramos el empleado seleccionado\nconst employee=employees.find(emp=>emp.id===employeeCode);if(!employee)throw new Error('Empleado no encontrado');// 2. Determinamos su rol real\nconst realRole=determineRole(employee.rolId);console.log(\"Login: \".concat(employee.nombre,\" \").concat(employee.apellido));console.log(\"Rol ID: \".concat(employee.rolId,\" -> Rol Sistema: \").concat(realRole));// 3. Guardamos la sesión compatible con ambos squads\nconst userData={id:employee.id,employeeCode:employee.id,name:\"\".concat(employee.nombre,\" \").concat(employee.apellido),role:realRole,originalRole:(_employee$rol=employee.rol)===null||_employee$rol===void 0?void 0:_employee$rol.nombre};sessionStorage.setItem('user',JSON.stringify(userData));sessionStorage.setItem('isAuthenticated','true');// 4. Redirección inteligente\n// Si es Manager, va al selector general\n// Si es Dev, va directo a carga de horas\nif(realRole==='MANAGER'){navigate('/modulos');}else{navigate('/desarrollador/seleccion-proyectos');}}catch(error){setError('Error al iniciar sesión');setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen p-4 bg-gray-100 text-gray-800\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md bg-white rounded-xl shadow-lg p-8 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold text-gray-900\",children:\"PSA\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mt-1\",children:\"Sistema de Gesti\\xF3n Integrado\"})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-center text-gray-900\",children:\"Bienvenido\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border-l-4 border-red-500 p-4 text-red-700 text-sm\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Identif\\xEDquese\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1\",children:loadingEmployees?/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center py-3 text-gray-500 text-sm\",children:[/*#__PURE__*/_jsx(Loader,{className:\"w-5 h-5 animate-spin mr-2\"}),\" Conectando...\"]}):/*#__PURE__*/_jsxs(\"select\",{className:\"block w-full px-3 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\",value:employeeCode,onChange:e=>setEmployeeCode(e.target.value),disabled:loading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccionar usuario...\"}),employees.map(emp=>/*#__PURE__*/_jsxs(\"option\",{value:emp.id,children:[emp.nombre,\" \",emp.apellido,\" (\",getRoleLabel(emp.rolId),\")\"]},emp.id))]})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-colors\",type:\"submit\",disabled:loading||loadingEmployees||!employeeCode,children:loading?'INGRESANDO...':'INGRESAR'})]}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-8 text-center text-xs text-gray-400\",children:\"\\xA9 2025 PSA Systems\"})]})});};export default LoginPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","Loader","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","ROL_ID_DEVELOPER","ROL_ID_MANAGER","LoginPage","navigate","employees","setEmployees","employeeCode","setEmployeeCode","loading","setLoading","loadingEmployees","setLoadingEmployees","error","setError","determineRole","rolId","getRoleLabel","loadEmployees","response","fetch","concat","ok","Error","data","json","console","log","sessionStorage","clear","handleLogin","e","preventDefault","_employee$rol","employee","find","emp","id","realRole","nombre","apellido","userData","name","role","originalRole","rol","setItem","JSON","stringify","className","children","onSubmit","value","onChange","target","disabled","map","type"],"sources":["/home/agusdubo/Desktop/IS1/tribu-A-frontend-2025-2C/src/pages/LoginPage.js"],"sourcesContent":["import React, { useState, useEffect} from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Loader } from 'lucide-react';\n\nconst API_BASE_URL = 'http://localhost:8080';\n\n// ID de Roles\n// ID '1f14...': Aparece en Martin, Lucia, Mariana -> Asumimos DEVELOPER\nconst ROL_ID_DEVELOPER = \"1f14a491-e26d-4092-86ea-d76f20c165d1\";\n// ID '6e6e...': Aparece solo en Horacio -> Asumimos MANAGER\nconst ROL_ID_MANAGER = \"6e6ecd47-fa18-490e-b25a-c9101a398b6d\";\n\n\nconst LoginPage = () => {\n  const navigate = useNavigate();\n  const [employees, setEmployees] = useState([]);\n  const [employeeCode, setEmployeeCode] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [loadingEmployees, setLoadingEmployees] = useState(true);\n  const [error, setError] = useState('');\n\n\n  // ========================\n  // LOGICA DINAMICA DE ROLES\n  // ========================\n  const determineRole = (rolId) => {\n    if (!rolId) return 'DEVELOPER';\n\n    if (rolId === ROL_ID_MANAGER) {\n      return 'MANAGER';\n    }\n\n    return 'DEVELOPER'\n  };\n\n  // Helper para mostrar un nombre legible en el select\n  const getRoleLabel = (rolId) => {\n    if (rolId === ROL_ID_MANAGER) return 'Manager';\n    if (rolId === ROL_ID_DEVELOPER) return 'Desarrollador';\n    return 'Desconocido';\n  }\n\n  // Carga inicial de los empleados\n  useEffect(() => {\n    const loadEmployees = async () => {\n      try {\n        const response = await fetch(`${API_BASE_URL}/api/resources`);\n\n        if (!response.ok) {\n          throw new Error('No se pudo conectar con el sistema de RRHH')\n        }\n\n        const data = await response.json();\n        console.log('Empleados cargados:', data);\n        setEmployees(data);\n        setLoadingEmployees(false);\n      } catch (error) {\n        console.error('Error:', error);\n        setError('Error de conexión con el servidor');\n        setLoadingEmployees(false);\n      }\n    };\n\n    // Limpiamos sesión vieja al entrar al login\n    sessionStorage.clear();\n    loadEmployees();\n  }, []);\n\n  const handleLogin = (e) => {\n    e.preventDefault();\n    \n    if (!employeeCode) {\n      setError('Por favor seleccione un usuario');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      // 1. Encontramos el empleado seleccionado\n      const employee = employees.find(emp => emp.id === employeeCode);\n      if (!employee) throw new Error('Empleado no encontrado');\n\n      // 2. Determinamos su rol real\n      const realRole = determineRole(employee.rolId);\n\n      console.log(`Login: ${employee.nombre} ${employee.apellido}`);\n      console.log(`Rol ID: ${employee.rolId} -> Rol Sistema: ${realRole}`);\n\n      // 3. Guardamos la sesión compatible con ambos squads\n      const userData = {\n        id: employee.id,\n        employeeCode: employee.id,\n        name: `${employee.nombre} ${employee.apellido}`,\n        role: realRole,\n        originalRole: employee.rol?.nombre\n      };\n\n      sessionStorage.setItem('user', JSON.stringify(userData));\n      sessionStorage.setItem('isAuthenticated', 'true');\n\n      // 4. Redirección inteligente\n      // Si es Manager, va al selector general\n      // Si es Dev, va directo a carga de horas\n      if (realRole === 'MANAGER') {\n        navigate('/modulos');\n      } else {\n        navigate('/desarrollador/seleccion-proyectos');\n      }\n\n    } catch (error) {\n      setError('Error al iniciar sesión');\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen p-4 bg-gray-100 text-gray-800\">\n      <div className=\"w-full max-w-md bg-white rounded-xl shadow-lg p-8 space-y-6\">\n        <div className=\"text-center\">\n          <h1 className=\"text-4xl font-bold text-gray-900\">PSA</h1>\n          <p className=\"text-gray-500 mt-1\">Sistema de Gestión Integrado</p>\n        </div>\n        \n        <h2 className=\"text-2xl font-bold text-center text-gray-900\">Bienvenido</h2>\n        \n        {error && (\n           <div className=\"bg-red-50 border-l-4 border-red-500 p-4 text-red-700 text-sm\">\n             {error}\n           </div>\n        )}\n\n        <form onSubmit={handleLogin} className=\"space-y-6\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Identifíquese</label>\n            <div className=\"mt-1\">\n                {loadingEmployees ? (\n                    <div className=\"flex justify-center py-3 text-gray-500 text-sm\">\n                        <Loader className=\"w-5 h-5 animate-spin mr-2\"/> Conectando...\n                    </div>\n                ) : (\n                    <select \n                        className=\"block w-full px-3 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n                        value={employeeCode}\n                        onChange={(e) => setEmployeeCode(e.target.value)}\n                        disabled={loading}\n                    >\n                        <option value=\"\">Seleccionar usuario...</option>\n                        {employees.map(emp => (\n                            <option key={emp.id} value={emp.id}>\n                                {emp.nombre} {emp.apellido} ({getRoleLabel(emp.rolId)})\n                            </option>\n                        ))}\n                    </select>\n                )}\n            </div>\n          </div>\n          \n          <button \n            className=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-colors\" \n            type=\"submit\"\n            disabled={loading || loadingEmployees || !employeeCode}\n          >\n            {loading ? 'INGRESANDO...' : 'INGRESAR'}\n          </button>\n        </form>\n        \n        <p className=\"mt-8 text-center text-xs text-gray-400\">\n          © 2025 PSA Systems\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default LoginPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}